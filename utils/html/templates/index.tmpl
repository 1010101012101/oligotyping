<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <title>{{ project }}</title>

    <script type="text/javascript" src="jquery-1.7.1.js"></script>
    <script type="text/javascript" src="popup.js"></script>
    <script type="text/javascript" src="raphael.js"></script>
    <script type="text/javascript" src="g.raphael.js"></script>
    <script type="text/javascript" src="g.pie.js"></script>

{{ pie_charts_js }}

</head>

<body >
<div id="wrapper">
<div id="content">

<div class="head">Oligotyping Results for "{{ project }}"</div>
<div class="title">This page shows some preliminary results of your analysis</div>
<div class="links-bar"><a href="http://oligotyping.org">Oligotyping.org</a></div>


<div class="smallhead">General</div>
<p class="smallheadtitle">» General information about the run
<div class="info_table">
<table>
    {% if number_of_auto_components %}
    <tr><td id="l">{{pretty_names.number_of_auto_components}}</td><td id="r">{{number_of_auto_components}}</td></tr>
    {% else %}
    <tr><td id="l">{{pretty_names.number_of_selected_components}}</td><td id="r">{{number_of_selected_components}}</td></tr>
    {% endif %}

    <tr><td id="l">{{pretty_names.s}}</td><td id="r"> {{s}}</td></tr>
    <tr><td id="l">{{pretty_names.a}}</td><td id="r"> {{a}}%</td></tr>
    <tr><td colspan=2>&nbsp;</td></tr>
    <tr><td id="l">{{pretty_names.bases_of_interest_locs}}</td><td id="r"> {{bases_of_interest_locs}}</td></tr>
    <tr><td colspan=2>&nbsp;</td></tr>
    <tr><td id="l">{{pretty_names.num_unique_oligos}}</td><td id="r"> {{num_unique_oligos}}</td></tr>
    <tr><td id="l">{{pretty_names.num_oligos_after_s_elim}}</td><td id="r"> {{num_oligos_after_s_elim}}</td></tr>
    <tr><td id="l">{{pretty_names.num_oligos_after_a_elim}}</td><td id="r"> {{num_oligos_after_a_elim}}</td></tr>
    <tr><td colspan=2>&nbsp;</td></tr>
    <tr><td id="l">{{pretty_names.total_seq}}</td><td id="r"> {{total_seq}}</td></tr>
    <tr><td id="l">{{pretty_names.num_sequences_after_qc}}</td><td id="r"> {{num_sequences_after_qc}}</td></tr>
    <tr><td id="l">{{pretty_names.num_datasets_in_fasta}}</td><td id="r"> {{num_datasets_in_fasta}}</td></tr>
    <tr><td id="l">{{pretty_names.datasets_removed_after_qc}}</td><td id="r"> {{datasets_removed_after_qc|length}} {% if datasets_removed_after_qc|length > 0 %} ({{datasets_removed_after_qc|join:", "}}){% endif %}</td></tr>
</table>
</div>


<div class="smallhead">Download</div>
<p class="smallheadtitle">» Files to analyze results further via third partry applications
<div class="info_table">
<table>
    <tr><td id="l">{{pretty_names.matrix_count_file_path}}</td><td id="r"><a href="{{matrix_count_file_path}}">matrix_counts.txt</a></td></tr>
    <tr><td id="l">{{pretty_names.matrix_percent_file_path}}</td><td id="r"><a href="{{matrix_percent_file_path}}">matrix_percents.txt</a></td></tr>
    <tr><td id="l">{{pretty_names.environment_file_path}}</td><td id="r"><a href="{{environment_file_path}}">environment.txt</a></td></tr>
    <tr><td id="l">{{pretty_names.oligos_fasta_file_path}}</td><td id="r"><a href="{{oligos_fasta_file_path}}">oligos.fa.txt</a></td></tr>
    <tr><td id="l">{{pretty_names.oligos_nexus_file_path}}</td><td id="r"><a href="{{oligos_nexus_file_path}}">oligos.nex.txt</a></td></tr>
</table>
</div>



<div class="smallhead">Entropy</div>
<p class="smallheadtitle">» Entropy values that components were picked from
<p align="center"><a href="{{ entropy_figure }}"><img src="{{ entropy_figure }}" style="max-width:1200px" border="0"></a>

<div class="smallhead">Stackbar</div>
<p class="smallheadtitle">» Oligotype Profiles Among Datasets
<p align="center"><a href="{{ stackbar_figure }}"><img src="{{ stackbar_figure }}" style="max-width:1200px" border="0"></a>


<div class="smallhead">Oligotypes</div><p class="smallheadtitle">» Abundan oligotypes with their frequencies within the dataset are shown below along with the most frequent sequence within the group of oligotype. {% if blast_results_found %}<span class="check">✓</span> indicates that the most frequent sequence which was represented by the given oligotype hit something duing the BLAST search with 100% identity. In contrary, <span class="cross">✗</span> sign means that there was no perfect hit during the BLAST search. <br /><br /> Here are the oligotypes with a perfect hit: {% for oligo in oligos %} {% if oligo_reps_dict.blast_results|lookup:oligo|lookup:0|lookup:"identity" == 100.0 %} {{oligo}}, {% endif %}{% endfor %}{% else %}BLAST results are missing for this analysis.{% endif %}

{% if output_directory_for_reps %}
    <div class="wrap">
        <div id='sequences' style="height: auto;"> 
            <div style="width: {% if alignment_length|multiply:8 > 800 %}{{alignment_length|multiply:8}}{% else %}800{%endif%}px; position: relative;">
                     <p>
                        <span class="check">&nbsp;</span>
                        <span class="frequency">&nbsp;</span>
                        <span style="background-color:{{white}}; border: 1px solid white;">&nbsp;&nbsp;</span>
                        <span style="color: white;"> <strong>{{oligos.0}}</strong> b {{ component_reference|safe }}</span>
                {% for oligo in oligos %}
                    <p>
                        {% if blast_results_found %}
                            {% if oligo_reps_dict.blast_results|lookup:oligo|lookup:0|lookup:"identity" == 100.0 %}
                                <span class="check">✓</span>
                            {% else %}
                                <span class="cross">✗</span>
                            {% endif %}
                        {% else %}
                            <span class="check">&nbsp;</span>
                        {% endif %}
                        </span>
                        <span class="frequency">{{ frequency|lookup:oligo }}</span>
                        <span style="background-color:{{color_dict|lookup:oligo}}; border: 1px solid black;">&nbsp;&nbsp;</span>
                        <span style="border-bottom:1px solid {{ color_dict|lookup:oligo }}"> <strong><a onmouseover="popup('<img src={{oligo_reps_dict.imgs|lookup:oligo}} width=&quot;790&quot;>', 800)" href="oligo_{{oligo}}.html">{{oligo}}</a></strong> <em><a title="BLAST search this sequence in NCBI" href="http://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&BLAST_PROGRAMS=megaBlast&PAGE_TYPE=BlastSearch&SHOW_DEFAULTS=on&LINK_LOC=blasthome&DATABASE=nr&QUERY=>{{ oligo }}%0d{{ rep_oligo_seqs_clean_dict|lookup:oligo|cleangaps }}">b</a></em> {{ rep_oligo_seqs_fancy_dict|lookup:oligo|safe }}</span>
                {% endfor %}
            </div>
        </div>
    </div>
{% else %}
    <div> 
        <p class="error">Representative sequences were not computed during the analysis (running oligotyping process with --quick parameter may cause this), in order to obtain more information about representative sequences you need to re-run the analysis.
        <div class="wrap">
        <p style="line-height:200%;">
        {% for oligo in oligos %}
            <span style="padding: 20px;"><span style="background-color:{{color_dict|lookup:oligo}}; border: 1px solid black;">&nbsp;&nbsp;</span> <span style="border-bottom:1px solid {{ color_dict|lookup:oligo }}"> <strong>{{oligo}}</strong></span></span>
        {% endfor %}
        </div>
    </div>
{% endif %}

</div>
</div>

<div class="smallhead">Datasets</div>
<p class="smallheadtitle">» Overview of datasets.
{% for dataset in datasets %}
{% if forloop.counter0|mod:3 == 0 %}
    <div id="p_container_{{forloop.counter0}}"></div>
{% endif %}
{% endfor %}



<div class="footer"><p>For questions and comments: meren / mbl.edu</div>
</body>
</html>


